(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{317:function(s,t,a){"use strict";a.r(t);var n=a(7),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"_1-机器配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-机器配置"}},[s._v("#")]),s._v(" 1. 机器配置")]),s._v(" "),t("p",[s._v("系统版本：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/01.kubernetes/01.%E4%BD%BF%E7%94%A8kubeadm%E5%BC%95%E5%AF%BC%E9%9B%86%E7%BE%A4/img/osenv.png",alt:"osenv.png"}})]),s._v(" "),t("h3",{attrs:{id:"_1-1-设置hosts-所有机器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-设置hosts-所有机器"}},[s._v("#")]),s._v(" 1.1  设置hosts （所有机器）")]),s._v(" "),t("p",[s._v("本次集群规模为3master 和4node ， 外加一个harbor 存储镜像 信息如下：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("root@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/hosts ")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.24")]),s._v(".10.105\t\t\t\tcluster-master-01\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.24")]),s._v(".10.106\t\t\t\tcluster-master-02\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.24")]),s._v(".10.107\t\t\t\tcluster-master-03\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.24")]),s._v(".10.108\t\t\t\tcluster-node-01\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.24")]),s._v(".10.109\t\t\t\tcluster-node-02\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.24")]),s._v(".10.110\t\t\t\tcluster-node-03\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.24")]),s._v(".10.111\t\t\t\tcluster-node-04\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.24")]),s._v(".10.102\t\t\t\tharbor.xiaobai1202.com\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h3",{attrs:{id:"_1-2-关闭swap、selinux、firewall-所有机器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-关闭swap、selinux、firewall-所有机器"}},[s._v("#")]),s._v(" 1.2  关闭swap、selinux、firewall （所有机器）")]),s._v(" "),t("p",[s._v("swap")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时关闭")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# swapoff -a")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 永久关闭  注释掉swap的挂载（建议永久关闭）")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi /etc/fstab ")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("selinux")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 若存在配置文件")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#若不存在 则直接新建一个：")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo 'SELINUX=disabled' >> /etc/selinux/config")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("防火墙")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("root@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ufw disable")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# service ufw stop ")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl disable ufw")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"_1-3-同步系统时间-所有机器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-同步系统时间-所有机器"}},[s._v("#")]),s._v(" 1.3 同步系统时间 （所有机器）")]),s._v(" "),t("p",[s._v("首先，先修正系统时区 UTC+8")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 首先查看支持的时区")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# timedatectl list-timezones")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下面这句有输出的话就是支持北京时间的")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# timedatectl list-timezones | grep 'Asia/Shanghai'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置时区为北京时间")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# timedatectl set-timezone Asia/Shanghai")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看时区")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# timedatectl")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("输出如下为正常：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/01.kubernetes/01.%E4%BD%BF%E7%94%A8kubeadm%E5%BC%95%E5%AF%BC%E9%9B%86%E7%BE%A4/img/timezone.png",alt:"timezone.png"}})]),s._v(" "),t("p",[s._v("然后使用时间服务器进行同步")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭默认同步")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# timedatectl set-ntp false ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装ntpdate")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# apt install ntpdate ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同步时间  ")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /usr/sbin/ntpdate ntp.aliyun.co")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置每天定时同步")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# crontab -e")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加如下行 （去掉注释）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 05 00 * * * /usr/sbin/ntpdate ntp.aliyun.com")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h3",{attrs:{id:"_1-4-开启转发-所有机器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-开启转发-所有机器"}},[s._v("#")]),s._v(" 1.4 开启转发 （所有机器）")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第一步 启用内核模块")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# modprobe overlay")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# modprobe br_netfilter")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lsmod | grep br_netfilter")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第二步  写入配置 ")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat > /etc/sysctl.d/k8s.conf <<EOF")]),s._v("\nnet.bridge.bridge-nf-call-ip6tables "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nnet.bridge.bridge-nf-call-iptables "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nnet.ipv4.ip_forward "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nEOF\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第三步  刷新配置")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sysctl -p /etc/sysctl.d/k8s.conf")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h2",{attrs:{id:"_2-安装容器运行时-containerd-所有机器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装容器运行时-containerd-所有机器"}},[s._v("#")]),s._v(" 2  安装容器运行时 containerd （所有机器）")]),s._v(" "),t("h3",{attrs:{id:"_2-1-安装参考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-安装参考"}},[s._v("#")]),s._v(" 2.1 安装参考")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/containerd/containerd/blob/main/docs/getting-started.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/containerd/containerd/blob/main/docs/getting-started.md"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("安装containerd/ runc/ cni plugins")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载containerd 二进制")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget  https://github.com/containerd/containerd/releases/download/v1.6.9/containerd-1.6.9-linux-amd64.tar.gz")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压到指定位置")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar Cxzvf /usr/local containerd-1.6.2-linux-amd64.tar.gz")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成服务配置文件")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat > /usr/lib/systemd/system/containerd.service <<EOF")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Copyright The containerd Authors.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# Licensed under the Apache License, Version 2.0 (the "License");')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# you may not use this file except in compliance with the License.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# You may obtain a copy of the License at")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     http://www.apache.org/licenses/LICENSE-2.0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Unless required by applicable law or agreed to in writing, software")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# distributed under the License is distributed on an "AS IS" BASIS,')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# See the License for the specific language governing permissions and")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# limitations under the License.")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("containerd container runtime\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Documentation")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://containerd.io\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network.target local-fs.target\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#uncomment to enable the experimental sbservice (sandboxed) version of containerd/cri integration")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#Environment="ENABLE_CRI_SANDBOXES=sandboxed"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStartPre")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("-/sbin/modprobe overlay\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/bin/containerd\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("notify\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Delegate")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KillMode")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("process\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Restart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RestartSec")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Having non-zero Limit*s causes performance problems due to accounting overhead")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# in the kernel. We recommend using cgroups to do container-local accounting.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LimitNPROC")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("infinity\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LimitCORE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("infinity\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LimitNOFILE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("infinity\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Comment TasksMax if your systemd version does not supports it.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Only systemd 226 and above support this version.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TasksMax")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("infinity\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("OOMScoreAdjust")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("-999\nEOF\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新加载并启用containerd服务")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl daemon-reload")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable --now containerd")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# service containerd status")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装runc插件 ")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://github.com/opencontainers/runc/releases/download/v1.1.4/runc.amd64")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# install -m 755 runc.amd64 /usr/local/sbin/runc")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建文件夹并安装cni插件")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir -p /opt/cni/bin")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://github.com/containernetworking/plugins/releases/download/v1.1.1/cni-plugins-linux-amd64-v1.1.1.tgz")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar Cxzvf /opt/cni/bin cni-plugins-linux-amd64-v1.1.1.tgz ")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br")])]),t("h3",{attrs:{id:"_2-2-配置containerd-使用-systems-cgroup-所有机器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-配置containerd-使用-systems-cgroup-所有机器"}},[s._v("#")]),s._v(" 2.2 配置containerd 使用 systems cgroup （所有机器）")]),s._v(" "),t("p",[s._v("首先 生成默认配置：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("root@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sudo mkdir -p /etc/containerd/")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# containerd config default | sudo tee /etc/containerd/config.toml")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("然后替换其中的cgroup驱动为systemd")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("root@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sed -i 's/SystemdCgroup \\= false/SystemdCgroup \\= true/g' /etc/containerd/config.toml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 重点  这个一定要改")]),s._v("\nsandbox_image "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.6"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改完配置 重启containerd服务")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart containerd.service ")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable containerd.service")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h2",{attrs:{id:"_3-引导集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-引导集群"}},[s._v("#")]),s._v(" 3 引导集群")]),s._v(" "),t("h3",{attrs:{id:"_3-1-一些必要的工具-kubeadm、kubelet、kubectl、crictl-所有机器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-一些必要的工具-kubeadm、kubelet、kubectl、crictl-所有机器"}},[s._v("#")]),s._v(" 3.1 一些必要的工具（kubeadm、kubelet、kubectl、crictl） （所有机器）")]),s._v(" "),t("p",[s._v("安装crictl")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("root@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://github.com/kubernetes-sigs/cri-tools/releases/download/v1.25.0/crictl-v1.25.0-linux-amd64.tar.gz")]),s._v("\n\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar Cxzvf /usr/local/bin crictl-v1.25.0-linux-amd64.tar.gz")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 创建配置文件（/etc/crictl.yaml）")]),s._v("\n\nruntime-endpoint: unix:///run/containerd/containerd.sock\nimage-endpoint: unix:///run/containerd/containerd.sock\ntimeout: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\ndebug: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\npull-image-on-create: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\ndisable-pull-on-run: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("安装引导集群所需要的k8s组件工具")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加k8s源")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# apt install install -y apt-transport-https ca-certificates curl")]),s._v("\n\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl -fsSLo /usr/share/keyrings/kubernetes-archive-keyring.gpg  https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg")]),s._v("\n\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# echo "deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] http://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial main" | sudo tee /etc/apt/sources.list.d/kubernetes.list')]),s._v("\n\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# apt update")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装组件")]),s._v("\n\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# apt install kubeadm=1.25.3-00")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# apt install kubectl=1.25.3-00")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# apt install kubelet=1.25.3-00")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 冻结版本")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# apt-mark hold kubelet kubeadm kubectl")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("h3",{attrs:{id:"_3-2-为master-安装keepalived并配置-实现高可用-所有master节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-为master-安装keepalived并配置-实现高可用-所有master节点"}},[s._v("#")]),s._v(" 3.2 为master 安装keepalived并配置 实现高可用 （所有master节点）")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("root@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# apt install keepalived libul* ")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("在每个master节点的  /etc/keepalived 下面新建 k8s.conf (内容相同但是 vrrp_instance.priority不同)")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global_defs")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   router_id LVS_DEVEL\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("vrrp_instance")]),s._v(" VI_1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("state")]),s._v(" BACKUP\n    nopreempt\n    interface ens32\n    virtual_router_id "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    priority "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n    advert_int "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    authentication")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        auth_type PASS\n        auth_pass just0kk\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("virtual_ipaddress")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 虚拟接口地址")]),s._v("\n        172.24.10.201/24 \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("virtual_server")]),s._v(" 172.24.10.201 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delay_loop")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("\n    lb_algo loadbalance\n    lb_kind DR\n    net_mask 255.255.255.0\n    persistence_timeout "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    protocol TCP\n    real_server 172.24.10.105 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("weight")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n        SSL_GET")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("url")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              path /healthz\n              status_code 200\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            connect_timeout 3\n            nb_get_retry 3\n            delay_before_retry 3\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("real_server")]),s._v(" 172.24.10.106 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("weight")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n        SSL_GET")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("url")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              path /healthz\n              status_code 200\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            connect_timeout 3\n            nb_get_retry 3\n            delay_before_retry 3\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("real_server")]),s._v(" 172.24.10.107 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("weight")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n        SSL_GET")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("url")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              path /healthz\n              status_code 200\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            connect_timeout 3\n            nb_get_retry 3\n            delay_before_retry 3\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br")])]),t("p",[s._v("配置文件编辑好以后就可以启动了")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("root@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable keepalived  && systemctl start keepalived  && systemctl status keepalived")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_3-3-准备正式引导集群-master节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-准备正式引导集群-master节点"}},[s._v("#")]),s._v(" 3.3 准备正式引导集群（master节点）")]),s._v(" "),t("p",[s._v("在一个master 节点执行，注意control-plane-endpoint就是我们高可用的虚拟地址")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("root@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubeadm init \\")]),s._v("\n--apiserver-advertise-address "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--apiserver-bind-port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--control-plane-endpoint "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.24")]),s._v(".10.201 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--image-repository registry.cn-hangzhou.aliyuncs.com/google_containers "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--kubernetes-version v1.25.3 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--pod-network-cidr "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".0.0/16 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--service-cidr "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.221")]),s._v(".0.0/16 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--service-dns-domain k8s.xiaobai1202.com "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--upload-certs\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("执行完毕后 结果如下：\n"),t("img",{attrs:{src:"/01.kubernetes/01.%E4%BD%BF%E7%94%A8kubeadm%E5%BC%95%E5%AF%BC%E9%9B%86%E7%BE%A4/img/cluster-init.png",alt:"cluster-init.png"}})]),s._v(" "),t("p",[s._v("红框中的命令，若要加入更多的master 使用第一个命令  若要加入node 使用第二个命令")]),s._v(" "),t("p",[s._v("最后检查集群状态：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 任意一个master 执行")]),s._v("\nroot@cluster:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get nodes")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("img",{attrs:{src:"/01.kubernetes/01.%E4%BD%BF%E7%94%A8kubeadm%E5%BC%95%E5%AF%BC%E9%9B%86%E7%BE%A4/img/node-not-ready.png",alt:"node-note-ready.png"}})]),s._v(" "),t("p",[s._v("not ready 是因为集群的网络插件没有安装 下一步 安装网络插件")]),s._v(" "),t("h2",{attrs:{id:"_4-安装网络插件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-安装网络插件"}},[s._v("#")]),s._v(" 4 安装网络插件")]),s._v(" "),t("p",[s._v("使用calico （需要修改自己pod的cidr和service的cidr，参考初始化集群时指定的cidr）")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://raw.githubusercontent.com/projectcalico/calico/v3.24.4/manifests/tigera-operator.yaml",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://raw.githubusercontent.com/projectcalico/calico/v3.24.4/manifests/tigera-operator.yaml"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("然后查看节点状态：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/01.kubernetes/01.%E4%BD%BF%E7%94%A8kubeadm%E5%BC%95%E5%AF%BC%E9%9B%86%E7%BE%A4/img/node-ready.png",alt:"node-ready.png"}})]),s._v(" "),t("p",[s._v("done！")])])}),[],!1,null,null,null);t.default=e.exports}}]);